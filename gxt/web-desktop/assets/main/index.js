System.register("chunks:///_virtual/main",["./Main.ts"],(function(){"use strict";return{setters:[null],execute:function(){}}}));

System.register("chunks:///_virtual/Main.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){"use strict";var e,i,n,s,a,o,r,h,p,l,d,u,c,y,m,v,f,g,w,C,S,T,b,x,R,z,L,M,I,j;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,s=t.assertThisInitialized,a=t.asyncToGenerator,o=t.regeneratorRuntime},function(t){r=t.cclegacy,h=t._decorator,p=t.Button,l=t.Node,d=t.TiledMap,u=t.UITransform,c=t.BoxCollider2D,y=t.RigidBody2D,m=t.ERigidBody2DType,v=t.Vec2,f=t.input,g=t.Input,w=t.Contact2DType,C=t.game,S=t.KeyCode,T=t.Animation,b=t.Vec3,x=t.PhysicsSystem2D,R=t.ERaycast2DType,z=t.Component,L=t.loader,M=t.instantiate,I=t.Label,j=t.tween}],execute:function(){var A,k,B,D,E,O,_,H,N;r._RF.push({},"1834bdQHUZB44rYDD2ayOXf","Main",void 0);var X=h.ccclass,G=h.property;t("Main",(A=X("Main"),k=G(p),B=G(p),D=G(l),A((_=e((O=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))||this).tieldMap=void 0,e.wallLayer=void 0,e.player=void 0,e.camera=void 0,e.moveX=0,e.speed=300,e.state="Idle",e.oldState="Idle",e.height=28,e.width=24,e.jumpMaxSpeed=500,e.jumpSpeed=0,e.downSpeed=1e3,e.hitMaxTime=.5,e.hitAddTime=0,e.hitCount=0,e.hitCdAddTime=0,n(e,"btn",_,s(e)),n(e,"restartBtn",H,s(e)),n(e,"gameOverNode",N,s(e)),e}i(e,t);var r=e.prototype;return r.onLoad=function(){this.gameOverNode.active=!1,this.tieldMap=this.node.getChildByName("TiledMap").getComponent(d),this.wallLayer=this.tieldMap.getLayer("wall"),this.player=this.node.getChildByName("Player"),this.height=this.player.getComponent(u).contentSize.y/2,this.width=this.player.getComponent(c).size.x,this.camera=this.node.getChildByName("Camera");for(var t=this.tieldMap.getTileSize(),e=this.wallLayer.getLayerSize(),i=0;i<e.width;i++)for(var n=0;n<e.height;n++){var s=this.wallLayer.getTiledTileAt(i,n,!0);if(0!=s.grid){var a=s.addComponent(y);a.type=m.Static,a.group=1,a.enabledContactListener=!0;var o=s.addComponent(c);o.offset=new v(t.width/2,t.height/2),o.size=t,o.group=1,o.apply()}}f.on(g.EventType.KEY_DOWN,this.onKeyDown,this),f.on(g.EventType.KEY_UP,this.onKeyUp,this),this.player.getComponent(c).on(w.BEGIN_CONTACT,this.onBeginContact,this),this.btn.node.on(p.EventType.CLICK,this.clickEvent,this),this.restartBtn.node.on(p.EventType.CLICK,this.clickEvent,this)},r.clickEvent=function(t){C.restart()},r.endGame=function(t){var e=this;console.log("游戏结束"),setTimeout((function(){e.gameOverNode.active=!0,t.active=!1}),.1)},r.onBeginContact=function(){var t=a(o().mark((function t(e,i,n){var s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(4!=i.group){t.next=3;break}return this.endGame(i.node),t.abrupt("return");case 3:if(2==i.group){t.next=5;break}return t.abrupt("return");case 5:this.hitCdAddTime>.1&&this.hitCount++,s=this,L.loadRes("Label",(function(t,e){var i=M(e);i.getComponent(I).string="连击："+s.hitCount.toString(),i.parent=s.node,i.position=s.player.position,j(i).to(.1,{position:new b(s.player.position.x,s.player.position.y+50,s.player.position.z),scale:new b(1.2,1.2,1)}).start(),j(i).delay(.5).removeSelf().start()})),this.hitCdAddTime=0,this.state="Hit",this.jumpSpeed=this.jumpMaxSpeed,this.hitAddTime=0,this.updateState();case 13:case"end":return t.stop()}}),t,this)})));return function(e,i,n){return t.apply(this,arguments)}}(),r.onKeyDown=function(t){t.keyCode==S.ARROW_RIGHT&&(this.moveX=this.speed),t.keyCode==S.ARROW_LEFT&&(this.moveX=-this.speed),t.keyCode==S.ARROW_UP&&"Jump"!=this.state&&"Fall"!=this.state&&"Hit"!=this.state&&(this.jumpSpeed=this.jumpMaxSpeed)},r.onKeyUp=function(t){t.keyCode==S.ARROW_RIGHT&&this.moveX==this.speed&&(this.moveX=0),t.keyCode==S.ARROW_LEFT&&this.moveX==-this.speed&&(this.moveX=0)},r.updateState=function(){this.oldState!=this.state&&(this.player.getComponent(T).play(this.state),this.oldState=this.state)},r.lateUpdate=function(){var t=this.camera.position,e=this.player.position;this.camera.position=new b(e.x,e.y,t.z)},r.updateHit=function(t){this.hitAddTime+=t;var e;e=this.jumpSpeed,this.jumpSpeed>-this.jumpMaxSpeed&&(this.jumpSpeed-=this.downSpeed*t*2);var i=this.player.position;i=new b(i.x-600*t,i.y+e*t,i.z),this.player.position=i,this.checkIsInGround()&&this.hitAddTime>this.hitMaxTime&&this.endHit()},r.showLabel=function(){var t=a(o().mark((function t(e){var i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=this,L.loadRes("Label",(function(t,n){var s=M(n);s.getComponent(I).string=e,s.parent=i.node,s.position=i.player.position,j(s).to(.2,{position:new b(i.player.position.x,i.player.position.y+50,i.player.position.z),scale:new b(2,2,1)}).start(),j(s).delay(.5).removeSelf().start()}));case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.endHit=function(){this.hitCount>5&&this.hitCount<=10?this.showLabel("666！"):this.hitCount>10&&this.showLabel("白玩了！"),this.state="Idle",this.hitCount=0},r.update=function(t){if(this.hitCdAddTime+=t,"Hit"!=this.state){if(this.moveX>0){var e=this.player.scale;this.player.setScale(new b(Math.abs(e.x),e.y,e.z)),this.state="Run"}else if(this.moveX<0){var i=this.player.scale;this.player.setScale(new b(-Math.abs(i.x),i.y,i.z)),this.state="Run"}else this.state="Idle";var n;this.player.worldPosition;n=this.jumpSpeed,this.jumpSpeed>-this.jumpMaxSpeed&&(this.jumpSpeed-=this.downSpeed*t);var s=this.player.position;s=new b(s.x+this.moveX*t,s.y+n*t,s.z),this.player.position=s,this.checkIsInGround()?this.jumpSpeed=0:this.jumpSpeed>0?this.state="Jump":this.state="Fall",this.updateState()}else this.updateHit(t)},r.checkIsInGround=function(){var t=this.player.worldPosition,e=new b(t.x-5,t.y,t.z),i=new b(t.x+5,t.y,t.z),n=new b(e.x,e.y-1e3,e.z),s=new b(i.x,i.y-1e3,i.z),a=x.instance.raycast(e,n,R.Closest);if(a.length){var o=a[0];if(1==o.collider.group){var r=o.point,h=b.distance(e,new b(r.x,r.y,0));if(!(this.height+1<=h))return!0}}if((a=x.instance.raycast(i,s,R.Closest)).length){var p=a[0];if(1==p.collider.group){var l=p.point,d=b.distance(i,new b(l.x,l.y,0));return!(this.height+1<=d)}}return!1},e}(z)).prototype,"btn",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(O.prototype,"restartBtn",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(O.prototype,"gameOverNode",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=O))||E));r._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});